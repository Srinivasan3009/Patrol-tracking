<div class="navi">
    <h2 > User Management</h2>
    <div class="roler">
      <button type="button" class="role" [routerLink]="['/navigation/role']" >Role</button>
    <img src="/assets/plus.png" (click)="showLoginForm = true"class="clickable-image" *ngIf="!showLoginForm" >
    </div>
</div>
<div  class="table-container">
  <h3>User List</h3>
  <table class="user-table">
    <thead>
      <tr>
        <th>User id</th>
        <th>Username</th>
        <th>Password</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngIf="users.length === 0">
      <td colspan="4">No users added yet.</td>
    </tr>
      <tr *ngFor="let user of users; let i = index">
        <td>{{ user.idNo }}</td>
        <td>{{ user.name }}</td>
        <td>{{ user.plain }}</td>
        <td>
          <button (click)="editUser(i)" class="update-btn">Update</button>
          <button (click)="removeUser(i)" class="remove-btn">Remove</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<div *ngIf="showLoginForm">
  <div class="login-overlay" (click)="showLoginForm = false"></div>
  <div class="login-form-container">
    <h3>Add User</h3>
    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
      <div class="form-actions">
      <div class="form-group">
        <label for="username">Username</label>
        <input type="text" id="username" formControlName="username" placeholder="Enter username"required>
        <div *ngIf="loginForm.get('username')?.invalid && loginForm.get('username')?.touched" class="error-message">Username is required
        </div>
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input type="text" class="form1" formControlName="email" name="email" placeholder="Email">
      </div>
      </div>
      <div class="form-actions">
      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" formControlName="password" placeholder="Enter password"required>
        <div *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.touched" class="error-message">Password is required</div>
      </div>
      <div class="form-group">
        <label for="designation">Designation</label>
        <input type="text" class="form1" formControlName="designation" name="designation" placeholder="Designation">
      </div>
      </div>
      <div class="form-actions">
      <div class="form-group">
        <label for="department">Department</label>
        <input type="text" class="form1" formControlName="department" name="department" placeholder="department">
      </div>
      <div class="form-group">
        <label for="mobilenumber">Mobile Number</label>
        <input type="number" class="form1" formControlName="mobilenumber" name="mobilenumber" placeholder="Mobile Number">
      </div>
      </div>
      <div class="form-actions">
      <div class="form-group">
        <label for="rolename">Role Name</label>
        <select formControlName="rolename">
          <option *ngFor="let r of roles" [value]="r.rolename" class="form1">{{ r.roleName }}</option>
        </select>      
      </div>
      </div>
      <div class="form-actions" style="justify-content: flex-end;">
        <button type="button" (click)="toggleLoginForm()" class="btn-cancel">Cancel</button>
        <button type="submit" [disabled]="!loginForm.valid" class="btn-submit">Submit</button>
      </div>
    </form>
  </div>
</div>
<div class="login-overlay" *ngIf="editIndex !== -1">
  <div class="login-form-container">
    <h3>Update User</h3>
    <form [formGroup]="updateForm" (ngSubmit)="UpdateUser()">
      <div class="form-group">
        <label for="edit-username">Username</label>
        <input 
          id="edit-username"
          type="text"
          formControlName="username"
          placeholder="Enter new username"
          required
        >
      </div>

      <div class="form-group">
        <label for="edit-password">Password</label>
        <input 
          id="edit-password"
          type="password"
          formControlName="password"
          placeholder="Enter new password"
          required
        >
      </div>

      <div class="form-actions">
        <button type="button" (click)="CancelEdit()" class="btn-cancel">
          Cancel
        </button>
        <button type="submit" [disabled]="!updateForm.valid" class="btn-submit">
          Update
        </button>
      </div>
    </form>
  </div>
</div>
